<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flix.id</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #4a90e2;
            --light-blue: #edf5ff;
            --dark-gray: #333;
            --medium-gray: #666;
            --light-gray: #ccc;
            --bg-color: #DCE3EB;
            --card-bg: rgba(255, 255, 255, 0.9);
            --glass-effect: rgba(255, 255, 255, 0.4);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-color: #333;
            --danger-red: #e74c3c;
            --danger-red-light: #fbe9e7;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background-color: var(--bg-color);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navbar */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 30px;
            position: relative;
            z-index: 100;
        }

        .navbar .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-gray);
            cursor: pointer;
            user-select: none;
        }

        .navbar .main-nav {
            display: flex;
            background: var(--glass-effect);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 8px;
            border: 1px solid var(--glass-border);
        }

        .navbar .main-nav button {
            background: none;
            border: none;
            padding: 8px 20px;
            border-radius: 25px;
            color: var(--medium-gray);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .navbar .main-nav button.active {
            background-color: var(--primary-blue);
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar .search-profile {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .navbar .search-bar {
            position: relative;
            background: var(--glass-effect);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 8px 15px;
            border: 1px solid var(--glass-border);
        }

        .navbar .search-bar input {
            background: none;
            border: none;
            outline: none;
            color: var(--dark-gray);
            padding-left: 10px;
            width: 150px;
            font-size: 16px;
        }

        .navbar .search-bar i {
            color: var(--medium-gray);
        }

        .upload-button {
            background-color: var(--primary-blue);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 30px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .upload-button:hover {
            background-color: #3a80d2;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        /* Hero Section */
        .hero-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .hero-card {
            position: relative;
            height: 300px;
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            align-items: flex-end;
            padding: 30px;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            background-size: cover;
            background-position: center;
            transition: background-image 0.5s ease;
            /* Added default background color */
            background-color: #a0b0c0;
        }

        .hero-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 50%);
            z-index: 1;
        }

        /* Default Hero Card Images */
        #movie-hero-1 { background-image: url('https://images.unsplash.com/photo-1549725227-825501ce011a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80'); }
        #movie-hero-2 { background-image: url('https://images.unsplash.com/photo-1603577789960-d72b2c9b4e7a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80'); }
        #series-hero-1 { background-image: url('https://placehold.co/1000x800/4a90e2/white?text=Latest+Series'); }
        #series-hero-2 { background-image: url('https://placehold.co/1000x800/3a80d2/white?text=Top+Series'); }
        #games-hero-1 { background-image: url('https://placehold.co/1000x800/e74c3c/white?text=Latest+Game'); }
        #games-hero-2 { background-image: url('https://placehold.co/1000x800/c0392b/white?text=Top+Game'); }
        #books-hero-1 { background-image: url('https://placehold.co/1000x800/2ecc71/white?text=Latest+Book'); }
        #books-hero-2 { background-image: url('https://placehold.co/1000x800/27ae60/white?text=Top+Book'); }


        .hero-card .content {
            position: relative;
            z-index: 2;
        }

        .hero-card h2 {
            font-size: 32px;
            margin-bottom: 10px;
            line-height: 1.2;
        }

        .hero-card p {
            font-size: 16px;
            margin-bottom: 20px;
            max-width: 80%;
        }

        .hero-card .play-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(5px);
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .hero-card .play-button:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
        }

        /* Home Page Carousel Styles */
        .home-category {
            margin-bottom: 40px;
        }
        
        .home-category h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark-gray);
        }
        
        .home-carousel {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 20px; /* For scrollbar spacing */
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        
        .home-carousel::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        
        .home-carousel .home-hero-card {
            position: relative;
            width: 300px;
            height: 200px;
            flex-shrink: 0;
            border-radius: 15px;
            overflow: hidden;
            display: flex;
            align-items: flex-end;
            padding: 20px;
            color: white;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            background-size: cover;
            background-position: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .home-carousel .home-hero-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 60%);
            z-index: 1;
        }

        .home-carousel .home-hero-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .home-carousel .home-hero-card .content {
            position: relative;
            z-index: 2;
        }

        .home-carousel .home-hero-card .title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .home-carousel .home-hero-card .genre {
            font-size: 14px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .no-cards-msg {
            color: var(--medium-gray);
            font-style: italic;
        }


        /* Category Filters */
        .category-filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            background: var(--glass-effect);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 10px 20px;
            border: 1px solid var(--glass-border);
            /* --- REMOVED OVERFLOW --- */
            /* overflow-x: auto; */
            /* -ms-overflow-style: none; */
            /* scrollbar-width: none; */
        }
        /* .category-filters::-webkit-scrollbar {
            display: none;
        } */


        .category-filters .filter-group {
            display: flex;
            gap: 10px;
            /* --- MODIFIED --- */
            /* flex-shrink: 0; */
            flex-wrap: wrap; /* Added this */
            flex-grow: 1; /* Allow group to grow */
        }

        .category-filters .filter-button {
            background: none;
            border: none;
            padding: 8px 18px;
            border-radius: 25px;
            color: var(--medium-gray);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .category-filters .filter-button i {
            color: var(--medium-gray);
        }

        .category-filters .filter-button.active,
        .category-filters .filter-button:hover {
            background-color: var(--light-blue);
            color: var(--primary-blue);
        }

        .category-filters .filter-button.active i,
        .category-filters .filter-button:hover i {
            color: var(--primary-blue);
        }

        /* --- NEW STYLES for "Show All" --- */
        .category-filters .filter-button.extra-filter {
            display: none; /* Hide extra filters by default */
        }

        .category-filters .filter-group.expanded .filter-button.extra-filter {
            display: flex; /* Show them when parent is expanded */
        }

        .category-filters .filter-button.show-all-btn {
            background-color: var(--light-blue);
            color: var(--primary-blue);
            font-weight: 600;
        }
        /* --- END NEW STYLES --- */


        .category-filters .display-options {
            display: flex;
            margin-left: 20px; /* Added margin */
            flex-shrink: 0; /* Prevent shrinking */
        }

        .category-filters .display-options button {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--medium-gray);
            cursor: pointer;
            margin-left: 10px;
        }

        .category-filters .display-options button.active {
            color: var(--primary-blue);
        }

        /* Trending Section */
        .trending-section h3 {
            font-size: 24px;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 25px;
        }

        .movie-card {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease;
            position: relative;
        }

        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .movie-card.deleting {
            opacity: 0;
            transform: scale(0.9);
        }

        .card-icons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            z-index: 2;
        }
        
        .card-icons button {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 50%;
            color: white;
            width: 30px;
            height: 30px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            opacity: 0;
        }
        
        .movie-card:hover .card-icons button {
            opacity: 1;
        }

        .card-icons button:hover {
            background: var(--primary-blue);
        }
        
        .card-icons .delete-btn:hover {
            background: var(--danger-red);
        }


        .movie-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        .movie-card .details {
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .movie-card .details .title {
            font-weight: 600;
            font-size: 16px;
            color: var(--dark-gray);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .movie-card .details .meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: var(--medium-gray);
        }

        .movie-card .details .rating {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
            color: var(--primary-blue);
        }

        .movie-card .details .rating i {
            color: gold;
            font-size: 14px;
        }
        
        .movie-card .details .genre {
            font-size: 12px;
            color: var(--medium-gray);
            font-style: italic;
        }

        /* Upload Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .upload-modal {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .upload-modal {
            transform: scale(1);
        }

        .upload-modal h2 {
            margin-top: 0;
            margin-bottom: 25px;
            color: var(--dark-gray);
            text-align: center;
        }
        
        .upload-form .form-group {
            margin-bottom: 20px;
        }
        
        .upload-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--medium-gray);
            font-size: 14px;
        }
        
        .upload-form input,
        .upload-form select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        
        .upload-form input:focus,
        .upload-form select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px var(--light-blue);
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .form-actions button {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .form-actions .btn-submit {
            background-color: var(--primary-blue);
            color: white;
        }
        .form-actions .btn-submit:hover {
            background-color: #3a80d2;
        }
        
        .form-actions .btn-cancel {
            background-color: #f0f0f0;
            color: var(--medium-gray);
        }
        .form-actions .btn-cancel:hover {
            background-color: #e0e0e0;
        }

        /* Custom Confirmation Modal */
        #confirm-modal {
            z-index: 1001;
        }

        #confirm-modal .upload-modal {
            max-width: 400px;
            text-align: center;
        }
        
        #confirm-modal h3 {
            margin-top: 0;
            color: var(--dark-gray);
        }
        
        #confirm-modal p {
            color: var(--medium-gray);
            margin-bottom: 25px;
        }
        
        #confirm-modal .form-actions button {
            font-size: 14px;
        }
        
        #confirm-modal .btn-confirm-delete {
            background-color: var(--danger-red);
            color: white;
        }
        #confirm-modal .btn-confirm-delete:hover {
            background-color: #c0392b;
        }

        /* Custom Message/Alert */
        .show-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark-gray);
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 500;
            z-index: 2000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .show-message.show {
            opacity: 1;
            visibility: visible;
            top: 30px;
        }
        .show-message.success {
            background-color: #2ecc71;
        }
        .show-message..error {
            background-color: var(--danger-red);
        }

    </style>
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="logo" id="logo-btn">Flix.id</div>
            <div class="main-nav">
                <button data-page="movie-page">Movie</button>
                <button data-page="series-page">Series</button>
                <button data-page="games-page">Games</button>
                <button data-page="books-page">Books</button>
            </div>
            <div class="search-profile">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search">
                </div>
                <button class="upload-button" id="open-upload-modal">
                    <i class="fas fa-plus"></i> Upload
                </button>
            </div>
        </nav>

        <!-- HOME PAGE (default) -->
        <main id="home-page" class="page-content">
            <section class="home-category">
                <h2>Latest Movies</h2>
                <div class="home-carousel" id="home-movies">
                    <!-- JS will populate this -->
                </div>
            </section>
            <section class="home-category">
                <h2>Latest Series</h2>
                <div class="home-carousel" id="home-series">
                    <!-- JS will populate this -->
                </div>
            </section>
            <section class="home-category">
                <h2>Latest Games</h2>
                <div class="home-carousel" id="home-games">
                    <!-- JS will populate this -->
                </div>
            </section>
            <section class="home-category">
                <h2>Latest Books</h2>
                <div class="home-carousel" id="home-books">
                    <!-- JS will populate this -->
                </div>
            </section>
        </main>

        <!-- PAGE 1: MOVIES (now hidden) -->
        <main id="movie-page" class="page-content" style="display: none;">
            <!-- === UPDATED HERO SECTION === -->
            <section class="hero-section">
                <div class="hero-card" id="movie-hero-1">
                    <div class="content">
                        <h2>The Adventure of Blue Sword</h2>
                        <button class="play-button"><i class="fas fa-play-circle"></i> Let Play Moview</button>
                    </div>
                </div>
                <div class="hero-card" id="movie-hero-2">
                    <div class="content">
                        <h2>Recalling the journey of Dol's exciting story</h2>
                        <button class="play-button"><i class="fas fa-play-circle"></i> Let Play Moview</button>
                    </div>
                </div>
            </section>

            <section class="category-filters">
                <div class="filter-group">
                    <!-- Buttons will be populated by JavaScript -->
                </div>
                <div class="display-options">
                    <button><i class="fas fa-bars"></i></button>
                    <button class="active"><i class="fas fa-grip-vertical"></i></button>
                </div>
            </section>

            <section class="trending-section">
                <h3>All Uploads</h3>
                <div class="movie-grid">
                    <!-- Cards will be populated from LocalStorage -->
                </div>
            </section>
        </main>

        <!-- PAGE 2: SERIES -->
        <main id="series-page" class="page-content" style="display: none;">
            <!-- === NEW HERO SECTION === -->
            <section class="hero-section">
                <div class="hero-card" id="series-hero-1">
                    <div class="content">
                        <h2>Latest Series</h2>
                        <button class="play-button"><i class="fas fa-play-circle"></i> View</button>
                    </div>
                </div>
                <div class="hero-card" id="series-hero-2">
                    <div class="content">
                        <h2>Top Series</h2>
                        <button class="play-button"><i class="fas fa-play-circle"></i> View</button>
                    </div>
                </div>
            </section>

            <section class="category-filters">
                <div class="filter-group">
                    <!-- Buttons will be populated by JavaScript -->
                </div>
                <div class="display-options">
                    <button><i class="fas fa-bars"></i></button>
                    <button class="active"><i class="fas fa-grip-vertical"></i></button>
                </div>
            </section>
            <section class="trending-section">
                <h3>All Series</h3>
                <div class="movie-grid">
                    <!-- Cards will be populated from LocalStorage -->
                </div>
            </section>
        </main>

        <!-- PAGE 3: GAMES -->
        <main id="games-page" class="page-content" style="display: none;">
            <!-- === NEW HERO SECTION === -->
            <section class="hero-section">
                <div class="hero-card" id="games-hero-1">
                    <div class="content">
                        <h2>Latest Game</h2>
                        <button class="play-button"><i class="fas fa-play-circle"></i> Play Now</button>
                    </div>
                </div>
                <div class="hero-card" id="games-hero-2">
                    <div class="content">
                        <h2>Top Game</h2>
                        <button class="play-button"><i class="fas fa-play-circle"></i> Play Now</button>
                    </div>
                </div>
            </section>

            <section class="category-filters">
                <div class="filter-group">
                    <!-- Buttons will be populated by JavaScript -->
                </div>
                <div class="display-options">
                    <button><i class="fas fa-bars"></i></button>
                    <button class="active"><i class="fas fa-grip-vertical"></i></button>
                </div>
            </section>
            <section class="trending-section">
                <h3>All Games</h3>
                <div class="movie-grid">
                    <!-- Cards will be populated from LocalStorage -->
                </div>
            </section>
        </main>

        <!-- PAGE 4: BOOKS -->
        <main id="books-page" class="page-content" style="display: none;">
             <!-- === NEW HERO SECTION === -->
             <section class="hero-section">
                <div class="hero-card" id="books-hero-1">
                    <div class="content">
                        <h2>Latest Book</h2>
                        <button class="play-button"><i class="fas fa-book-open"></i> Read Now</button>
                    </div>
                </div>
                <div class="hero-card" id="books-hero-2">
                    <div class="content">
                        <h2>Top Book</h2>
                        <button class="play-button"><i class="fas fa-book-open"></i> Read Now</button>
                    </div>
                </div>
            </section>

             <section class="category-filters">
                <div class="filter-group">
                    <!-- Buttons will be populated by JavaScript -->
                </div>
                <div class="display-options">
                    <button><i class="fas fa-bars"></i></button>
                    <button class="active"><i class="fas fa-grip-vertical"></i></button>
                </div>
            </section>
             <section class="trending-section">
                <h3>All Books</h3>
                <div class="movie-grid">
                    <!-- Cards will be populated from LocalStorage -->
                </div>
            </section>
        </main>
    </div>

    <!-- Upload Modal HTML -->
    <div class="modal-overlay" id="upload-modal-overlay">
        <div class="upload-modal">
            <h2 id="modal-title">Upload New Card</h2>
            <form class="upload-form" id="upload-form">
                <input type="hidden" id="upload-id">
                
                <div class="form-group">
                    <label for="uploadTitle">Title</label>
                    <input type="text" id="uploadTitle" required>
                </div>
                
                <div class="form-group">
                    <label for="uploadCategory">Category</label>
                    <select id="uploadCategory" required>
                        <option value="">-- Select a Category --</option>
                        <option value="movie">Movie</option>
                        <option value="series">Series</option>
                        <option value="game">Game</option>
                        <option value="book">Book</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="uploadGenre">Genre</label>
                    <input type="text" id="uploadGenre" list="genre-list" required>
                    <datalist id="genre-list">
                        <!-- Options will be populated by JS -->
                    </datalist>
                </div>
                
                <div class="form-group">
                    <label for="uploadTags">Tags (comma separated, e.g. trending, new)</label>
                    <input type="text" id="uploadTags">
                </div>
                
                <div class="form-group">
                    <label for="uploadCoverUrl">Cover Image URL</label>
                    <input type="url" id="uploadCoverUrl" required>
                </div>
                
                <div classs="form-actions">
                    <button type="button" class="btn-cancel" id="cancel-upload">Cancel</button>
                    <button type="submit" class="btn-submit" id="submit-upload">Submit Card</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Custom Confirmation Modal HTML -->
    <div class="modal-overlay" id="confirm-modal">
        <div class="upload-modal">
            <h3>Confirm Deletion</h3>
            <p>Are you sure you want to delete this card? This action cannot be undone.</p>
            <div class="form-actions">
                <button type="button" class="btn-cancel" id="cancel-delete">Cancel</button>
                <button type="button" class="btn-confirm-delete" id="confirm-delete-btn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Custom Message Element -->
    <div class="show-message" id="custom-message"></div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- LocalStorage Database Key ---
            const DB_KEY = 'flixIdCardsDB';

            // --- Page/Modal Elements ---
            const logoBtn = document.getElementById('logo-btn');
            const homePage = document.getElementById('home-page');
            const navButtons = document.querySelectorAll('.main-nav button');
            const pages = document.querySelectorAll('.page-content');
            const modalOverlay = document.getElementById('upload-modal-overlay');
            const modal = modalOverlay.querySelector('.upload-modal');
            const modalTitle = document.getElementById('modal-title');
            const openModalBtn = document.getElementById('open-upload-modal');
            const cancelBtn = document.getElementById('cancel-upload');
            const uploadForm = document.getElementById('upload-form');
            const submitBtn = document.getElementById('submit-upload');
            
            // --- Form Fields ---
            const cardIdInput = document.getElementById('upload-id');
            const titleInput = document.getElementById('uploadTitle');
            const categoryInput = document.getElementById('uploadCategory');
            const tagsInput = document.getElementById('uploadTags');
            const coverUrlInput = document.getElementById('uploadCoverUrl');
            const genreInput = document.getElementById('uploadGenre');
            const genreDatalist = document.getElementById('genre-list');

            // --- Delete Confirmation Modal Elements ---
            const confirmModalOverlay = document.getElementById('confirm-modal');
            const cancelDeleteBtn = document.getElementById('cancel-delete');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            let cardToDelete = null;

            // --- Message Element ---
            const messageEl = document.getElementById('custom-message');

            // --- === HELPER: Get Page ID from Category === ---
            function getPageIdForCategory(category) {
                if (!category) return null;
                if (category === 'movie' || category === 'series') {
                    return `${category}-page`;
                }
                // Add 's' for game and book
                return `${category}s-page`;
            }

            // --- === HELPER: Get Hero ID from Category === ---
            function getHeroIdForCategory(category) {
                if (!category) return null;
                if (category === 'movie' || category === 'series') {
                    return category;
                }
                // Add 's' for game and book
                return `${category}s`;
            }

            // --- Genre Definitions ---
            const genresByCategory = {
                movie: ['Action', 'Adventure', 'Animation', 'Comedy', 'Crime', 'Drama', 'Fantasy', 'Horror', 'Musical', 'Mystery', 'Romance', 'Science Fiction', 'Thriller', 'War', 'Western'],
                series: ['Action', 'Adventure', 'Animation', 'Comedy', 'Crime', 'Drama', 'Fantasy', 'Horror', 'Musical', 'Mystery', 'Romance', 'Science Fiction', 'Thriller', 'War', 'Western'],
                game: ['Action', 'Adventure', 'Role-Playing Game (RPG)', 'Shooter (First-Person / Third-Person)', 'Simulation', 'Strategy', 'Sports', 'Racing', 'Fighting', 'Puzzle', 'Platformer', 'Horror / Survival Horror', 'Sandbox / Open World', 'Battle Royale', 'MMORPG (Massively Multiplayer Online RPG)'],
                book: ['Fiction', 'Mystery', 'Thriller', 'Romance', 'Fantasy', 'Science Fiction (Sci-Fi)', 'Horror', 'Historical Fiction', 'Young Adult (YA)', 'Biography / Memoir', 'Self-Help', 'Non-Fiction', 'Adventure', 'Poetry', 'Children’s']
            };
            
            // --- Icon Definitions ---
            const genreIcons = {
                // Movie/Series
                'action': 'fas fa-mask',
                'adventure': 'fas fa-compass',
                'animation': 'fas fa-camera-retro',
                'comedy': 'fas fa-laugh',
                'crime': 'fas fa-handcuffs',
                'drama': 'fas fa-theater-masks',
                'fantasy': 'fas fa-dragon',
                'horror': 'fas fa-skull',
                'musical': 'fas fa-music',
                'mystery': 'fas fa-search',
                'romance': 'fas fa-heart',
                'science fiction': 'fas fa-rocket',
                'thriller': 'fas fa-bolt',
                'war': 'fas fa-fighter-jet',
                'western': 'fas fa-hat-cowboy',

                // Game Specific
                'role-playing game (rpg)': 'fas fa-shield-alt',
                'shooter (first-person / third-person)': 'fas fa-crosshairs',
                'simulation': 'fas fa-gamepad',
                'strategy': 'fas fa-chess',
                'sports': 'fas fa-football-ball',
                'racing': 'fas fa-flag-checkered',
                'fighting': 'fas fa-fist-raised',
                'puzzle': 'fas fa-puzzle-piece',
                'platformer': 'fas fa-cube',
                'horror / survival horror': 'fas fa-ghost',
                'sandbox / open world': 'fas fa-map-marked-alt',
                'battle royale': 'fas fa-parachute-box',
                'mmorpg (massively multiplayer online rpg)': 'fas fa-users',

                // Book Specific
                'fiction': 'fas fa-book',
                'science fiction (sci-fi)': 'fas fa-atom',
                'historical fiction': 'fas fa-landmark',
                'young adult (ya)': 'fas fa-child',
                'biography / memoir': 'fas fa-book-open',
                'self-help': 'fas fa-brain',
                'non-fiction': 'fas fa-book-reader',
                'poetry': 'fas fa-feather-alt',
                'children’s': 'fas fa-shapes',
                
                // Default
                'default': 'fas fa-tag'
            };

            // --- === Default Hero Data === ---
            const defaultHeroData = {
                movie: {
                    hero1: { title: "The Adventure of Blue Sword", button: "Let Play Moview", icon: "fa-play-circle", image: "url('https://images.unsplash.com/photo-1549725227-825501ce011a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80')" },
                    hero2: { title: "Recalling the journey of Dol's exciting story", button: "Let Play Moview", icon: "fa-play-circle", image: "url('https://images.unsplash.com/photo-1603577789960-d72b2c9b4e7a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80')" }
                },
                series: {
                    hero1: { title: "Latest Series", button: "View", icon: "fa-play-circle", image: "url('https://placehold.co/1000x800/4a90e2/white?text=Latest+Series')" },
                    hero2: { title: "Top Series", button: "View", icon: "fa-play-circle", image: "url('https://placehold.co/1000x800/3a80d2/white?text=Top+Series')" }
                },
                game: {
                    hero1: { title: "Latest Game", button: "Play Now", icon: "fa-play-circle", image: "url('https://placehold.co/1000x800/e74c3c/white?text=Latest+Game')" },
                    hero2: { title: "Top Game", button: "Play Now", icon: "fa-play-circle", image: "url('https://placehold.co/1000x800/c0392b/white?text=Top+Game')" }
                },
                book: {
                    hero1: { title: "Latest Book", button: "Read Now", icon: "fa-book-open", image: "url('https://placehold.co/1000x800/2ecc71/white?text=Latest+Book')" },
                    hero2: { title: "Top Book", button: "Read Now", icon: "fa-book-open", image: "url('https://placehold.co/1000x800/27ae60/white?text=Top+Book')" }
                }
            };


            // --- FUNCTION: Populate Filters ---
            function initializePageFilters(pageId, genres) {
                const page = document.getElementById(pageId);
                if (!page) return;
                const filterGroup = page.querySelector('.filter-group');
                if (!filterGroup) return;

                // --- MODIFIED: Added "Show All" logic ---
                const maxVisibleGenres = 6; // 6 genres + 'All' + 'Trending' = 8 items

                let buttonsHTML = `
                    <button class="filter-button active" data-filter="all"><i class="fas fa-grip-horizontal"></i> All</button>
                    <button class="filter-button" data-filter="trending"><i class="fas fa-fire"></i> Trending</button>
                `;

                genres.forEach((genre, index) => {
                    const iconKey = genre.toLowerCase();
                    const icon = genreIcons[iconKey] || genreIcons.default;
                    
                    // Add 'extra-filter' class if index is >= maxVisibleGenres
                    const extraClass = index >= maxVisibleGenres ? 'extra-filter' : '';
                    
                    buttonsHTML += `
                        <button class="filter-button ${extraClass}" data-filter="${genre.toLowerCase()}">
                            <i class="${icon}"></i> ${genre}
                        </button>
                    `;
                });

                // Add 'Show All' button only if there are hidden genres
                if (genres.length > maxVisibleGenres) {
                    buttonsHTML += `
                        <button class="filter-button show-all-btn">
                            <i class="fas fa-chevron-down"></i> Show All
                        </button>
                    `;
                }
                // --- END MODIFICATION ---

                filterGroup.innerHTML = buttonsHTML;
            }

            // --- Initialize filters for each page ---
            initializePageFilters('movie-page', genresByCategory.movie);
            initializePageFilters('series-page', genresByCategory.series);
            initializePageFilters('games-page', genresByCategory.game);
            initializePageFilters('books-page', genresByCategory.book);

            // --- Helper function to update Genre datalist ---
            function updateGenreDatalist(category, clearValue = true) {
                genreDatalist.innerHTML = '';
                if (clearValue) {
                    genreInput.value = '';
                }

                if (category && genresByCategory[category]) {
                    genresByCategory[category].forEach(genre => {
                        const option = document.createElement('option');
                        option.value = genre;
                        genreDatalist.appendChild(option);
                    });
                }
            }

            // --- Event Listener for Category Change ---
            categoryInput.addEventListener('change', () => {
                updateGenreDatalist(categoryInput.value, true);
            });


            // --- Page Navigation ---
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    pages.forEach(page => page.style.display = 'none');
                    
                    const targetPageId = button.dataset.page;
                    const targetPage = document.getElementById(targetPageId);
                    if (targetPage) {
                        targetPage.style.display = 'block';
                    }
                });
            });

            // --- Logo Button (Home) Navigation ---
            logoBtn.addEventListener('click', () => {
                navButtons.forEach(btn => btn.classList.remove('active'));
                pages.forEach(page => page.style.display = 'none');
                homePage.style.display = 'block';
            });

            // --- Custom Message Function ---
            function showMessage(message, type = 'info') {
                messageEl.textContent = message;
                messageEl.className = 'show-message';
                messageEl.classList.add(type);
                messageEl.classList.add('show');
                
                setTimeout(() => {
                    messageEl.classList.remove('show');
                }, 3000);
            }

            // --- LocalStorage Functions ---
            function getCardsDB() {
                return JSON.parse(localStorage.getItem(DB_KEY)) || [];
            }

            function saveCardsDB(db) {
                localStorage.setItem(DB_KEY, JSON.stringify(db));
            }

            // --- FUNCTION: Create Card HTML ---
            function createCardHTML(card) {
                const rating = (Math.random() * 4 + 6).toFixed(1);
                
                return `
                    <div class="movie-card" data-id="${card.id}" data-tags="${card.tags || ''}" data-genre="${(card.genre || '').toLowerCase()}">
                        <div class="card-icons">
                            <button class="edit-btn"><i class="fas fa-pencil-alt"></i></button>
                            <button class="delete-btn"><i class="fas fa-trash"></i></button>
                        </div>
                        <img src="${card.coverUrl}" alt="${card.title}" onerror="this.src='https://placehold.co/200x250/dce3eb/333?text=Image+Failed'">
                        <div class="details">
                            <div class="title">${card.title}</div>
                            <div class="genre">${card.genre || 'N/A'}</div>
                            <div class="meta">
                                <span class="rating"><i class="fas fa-star"></i> ${rating}</span>
                                <span>${new Date().getFullYear()}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // --- FUNCTION: Create Home Card HTML ---
            function createHomeCardHTML(card) {
                const fallbackImg = 'https://placehold.co/300x200/dce3eb/333?text=Image+Failed';
                return `
                    <div class="home-hero-card" 
                         style="background-image: url('${card.coverUrl}'), url('${fallbackImg}')"
                         data-category="${card.category}">
                        <div class="content">
                            <div class="title">${card.title}</div>
                            <div class="genre">${card.genre || 'N/A'}</div>
                        </div>
                    </div>
                `;
            }

            // --- FUNCTION: Load Cards from DB ---
            function loadCardsFromLocalStorage() {
                document.querySelectorAll('.movie-grid').forEach(grid => grid.innerHTML = '');
                
                const allCards = getCardsDB();
                allCards.forEach(card => {
                    const cardHTML = createCardHTML(card);
                    // --- FIX for inconsistent page IDs ---
                    const gridId = getPageIdForCategory(card.category);
                    const targetGrid = document.querySelector(`#${gridId} .movie-grid`);
                    
                    if (targetGrid) {
                        targetGrid.insertAdjacentHTML('beforeend', cardHTML);
                    } else {
                        console.warn(`Could not find grid for category: ${card.category}`);
                    }
                });
            }

            // --- FUNCTION: Populate Home Page ---
            function populateHomePage() {
                const allCards = getCardsDB();
                const categories = ['movie', 'series', 'game', 'book'];

                categories.forEach(category => {
                    // --- FIX for 'series' typo ---
                    const carouselId = (category === 'series') ? 'home-series' : `home-${category}s`;
                    const carousel = document.getElementById(carouselId);
                    if (!carousel) {
                        console.warn(`Could not find home carousel: ${carouselId}`);
                        return;
                    }

                    const categoryCards = allCards.filter(c => c.category === category).slice(-5).reverse();

                    if (categoryCards.length === 0) {
                        carousel.innerHTML = '<p class="no-cards-msg">No uploads in this category yet.</p>';
                    } else {
                        carousel.innerHTML = categoryCards.map(createHomeCardHTML).join('');
                    }
                });
            }

            // --- === FUNCTION: Update Category Hero === ---
            function updateCategoryHero(category) {
                if (!category) return;

                // --- FIX for inconsistent hero IDs (game vs games) ---
                const heroId = getHeroIdForCategory(category);
                if (!heroId) return;

                // 1. Find hero elements for this category
                const heroCard1 = document.getElementById(`${heroId}-hero-1`);
                const heroCard2 = document.getElementById(`${heroId}-hero-2`);

                if (!heroCard1 || !heroCard2) {
                    console.warn(`Hero cards not found for category: ${category} (using ID: ${heroId})`);
                    return; // Page doesn't have hero cards
                }

                const heroTitle1 = heroCard1.querySelector('.content h2');
                const heroButton1 = heroCard1.querySelector('.content .play-button');
                const heroTitle2 = heroCard2.querySelector('.content h2');
                const heroButton2 = heroCard2.querySelector('.content .play-button');

                // 2. Get default data
                const defaults = defaultHeroData[category];
                if (!defaults) return; // No default data for this category

                // 3. Get cards for this category, newest first
                const allCards = getCardsDB();
                const categoryCards = allCards.filter(card => card.category === category).reverse();

                // 4. Update Hero Card 1 (Last Uploaded)
                if (categoryCards.length > 0) {
                    const lastCard = categoryCards[0];
                    heroTitle1.textContent = lastCard.title;
                    heroButton1.innerHTML = `<i class="fas ${defaults.hero1.icon}"></i> ${defaults.hero1.button}`;
                    
                    // Set background image with fallback
                    const img1 = new Image();
                    img1.onload = () => heroCard1.style.backgroundImage = `url('${lastCard.coverUrl}')`;
                    img1.onerror = () => heroCard1.style.backgroundImage = defaults.hero1.image;
                    img1.src = lastCard.coverUrl;
                } else {
                    // Reset to default
                    heroTitle1.textContent = defaults.hero1.title;
                    heroButton1.innerHTML = `<i class="fas ${defaults.hero1.icon}"></i> ${defaults.hero1.button}`;
                    heroCard1.style.backgroundImage = defaults.hero1.image;
                }

                // 5. Update Hero Card 2 (Second-to-Last Uploaded)
                if (categoryCards.length > 1) {
                    const secondLastCard = categoryCards[1];
                    heroTitle2.textContent = secondLastCard.title;
                    heroButton2.innerHTML = `<i class="fas ${defaults.hero2.icon}"></i> ${defaults.hero2.button}`;
                    
                    // Set background image with fallback
                    const img2 = new Image();
                    img2.onload = () => heroCard2.style.backgroundImage = `url('${secondLastCard.coverUrl}')`;
                    img2.onerror = () => heroCard2.style.backgroundImage = defaults.hero2.image;
                    img2.src = secondLastCard.coverUrl;
                } else {
                    // Reset to default
                    heroTitle2.textContent = defaults.hero2.title;
                    heroButton2.innerHTML = `<i class="fas ${defaults.hero2.icon}"></i> ${defaults.hero2.button}`;
                    heroCard2.style.backgroundImage = defaults.hero2.image;
                }
            }

            // --- INITIAL LOAD ---
            loadCardsFromLocalStorage();
            populateHomePage();
            // --- Update all category heroes on load ---
            updateCategoryHero('movie');
            updateCategoryHero('series');
            updateCategoryHero('game');
            updateCategoryHero('book');


            // --- Upload Modal Logic ---
            
            function resetUploadModal() {
                uploadForm.reset();
                cardIdInput.value = '';
                modalTitle.textContent = 'Upload New Card';
                submitBtn.textContent = 'Submit Card';
                updateGenreDatalist('', true);
            }
            
            function showUploadModal() {
                modalOverlay.classList.add('show');
            }
            
            function hideUploadModal() {
                modalOverlay.classList.remove('show');
            }

            openModalBtn.addEventListener('click', () => {
                resetUploadModal();
                showUploadModal();
            });
            
            cancelBtn.addEventListener('click', hideUploadModal);
            
            modalOverlay.addEventListener('click', function(event) {
                if (event.target === modalOverlay) {
                    hideUploadModal();
                }
            });

            // --- Handle Form Submission (Upload and Edit) ---
            uploadForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                const editingCardId = cardIdInput.value;
                
                const newCard = {
                    id: editingCardId || `card_${new Date().getTime()}`,
                    title: titleInput.value,
                    category: categoryInput.value,
                    genre: genreInput.value,
                    tags: tagsInput.value,
                    coverUrl: coverUrlInput.value
                };

                let allCards = getCardsDB();
                let oldCategory = null; 

                try {
                    if (editingCardId) {
                        // --- EDITING ---
                        let cardToEdit = null;
                        
                        allCards = allCards.map(card => {
                            if (card.id === editingCardId) {
                                oldCategory = card.category; // Store old category
                                cardToEdit = document.querySelector(`.movie-card[data-id="${editingCardId}"]`);
                                return { ...card, ...newCard };
                            }
                            return card;
                        });
                        
                        if (!cardToEdit) throw new Error("Could not find card element to update.");

                        const newCardHTML = createCardHTML(newCard);
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = newCardHTML.trim();
                        const newCardElement = tempDiv.firstChild;
                        
                        cardToEdit.parentNode.replaceChild(newCardElement, cardToEdit);
                        
                        // --- FIX for inconsistent page IDs ---
                        const oldCategoryPageId = getPageIdForCategory(oldCategory);
                        const newCategoryPageId = getPageIdForCategory(newCard.category);

                        if (oldCategoryPageId !== newCategoryPageId) {
                            const targetGrid = document.querySelector(`#${newCategoryPageId} .movie-grid`);
                            if (!targetGrid) throw new Error(`Could not find grid for new category: ${newCard.category}`);
                            targetGrid.insertAdjacentElement('afterbegin', newCardElement);
                            showMessage('Card updated and moved!', 'success');
                        } else {
                            showMessage('Card updated!', 'success');
                        }

                    } else {
                        // --- UPLOADING NEW ---
                        allCards.push(newCard);
                        
                        const cardHTML = createCardHTML(newCard);
                        // --- FIX for inconsistent page IDs ---
                        const gridId = getPageIdForCategory(newCard.category);
                        
                        const targetGrid = document.querySelector(`#${gridId} .movie-grid`);
                        
                        if (!targetGrid) throw new Error(`Could not find grid for category: ${newCard.category}`);
                        
                        targetGrid.insertAdjacentHTML('afterbegin', cardHTML);
                        
                        showMessage('Card uploaded successfully!', 'success');
                    }

                    saveCardsDB(allCards);
                    // --- UPDATED: Update relevant hero(s) ---
                    updateCategoryHero(newCard.category);
                    if (oldCategory && oldCategory !== newCard.category) {
                        updateCategoryHero(oldCategory); // Update old category hero too if changed
                    }
                    populateHomePage();
                    uploadForm.reset();
                    hideUploadModal();
                    
                } catch (error) {
                    console.error("Error submitting form:", error);
                    showMessage(error.message || 'An unknown error occurred.', 'error');
                }
            });


            // --- Event Delegation (Edit/Delete/Filter/Home Card) ---
            document.querySelector('.container').addEventListener('click', function(event) {
                const editBtn = event.target.closest('.edit-btn');
                const deleteBtn = event.target.closest('.delete-btn');
                // --- MODIFIED: Exclude .show-all-btn from filter logic ---
                const filterBtn = event.target.closest('.filter-button:not(.show-all-btn)');
                const homeCard = event.target.closest('.home-hero-card');
                // --- NEW: Get show-all-btn ---
                const showAllBtn = event.target.closest('.show-all-btn');

                // --- NEW: Handle Show All Click ---
                if (showAllBtn) {
                    const filterGroup = showAllBtn.closest('.filter-group');
                    if (filterGroup) {
                        filterGroup.classList.toggle('expanded');
                        const isExpanded = filterGroup.classList.contains('expanded');
                        showAllBtn.innerHTML = isExpanded 
                            ? '<i class="fas fa-chevron-up"></i> Show Less' 
                            : '<i class="fas fa-chevron-down"></i> Show All';
                    }
                }

                // --- Handle Home Card Click ---
                if (homeCard) {
                    const category = homeCard.dataset.category;
                    if (category) {
                        // --- FIX for inconsistent page IDs ---
                        const pageId = getPageIdForCategory(category);
                        const targetNavButton = document.querySelector(`.main-nav button[data-page="${pageId}"]`);
                        if (targetNavButton) {
                            targetNavButton.click();
                        }
                    }
                }

                // --- Handle FILTER Click ---
                if (filterBtn) {
                    const filterType = filterBtn.dataset.filter.toLowerCase();
                    const filterGroup = filterBtn.closest('.filter-group');
                    const pageContent = filterBtn.closest('.page-content');
                    if (!filterGroup || !pageContent) return;

                    filterGroup.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
                    filterBtn.classList.add('active');

                    const titleElement = pageContent.querySelector('.trending-section h3');
                    if (titleElement) {
                        const filterText = filterBtn.textContent.trim();
                        if (filterType === 'all') {
                            // --- UPDATED: Capitalize page name ---
                            const pageName = pageContent.id.split('-')[0];
                            const capitalPageName = pageName.charAt(0).toUpperCase() + pageName.slice(1);
                            titleElement.textContent = `All ${capitalPageName}`;
                        } else if (filterType === 'trending') {
                            titleElement.textContent = 'Trending Now';
                        } else {
                            const genreName = filterText.charAt(0).toUpperCase() + filterText.slice(1);
                            titleElement.textContent = `Genre: ${genreName}`;
                        }
                    }

                    const grid = pageContent.querySelector('.movie-grid');
                    const cards = grid.querySelectorAll('.movie-card');

                    cards.forEach(card => {
                        let show = false;
                        if (filterType === 'all') {
                            show = true;
                        } else if (filterType === 'trending') {
                            const tags = card.dataset.tags.toLowerCase();
                            if (tags.includes('trending')) {
                                show = true;
                            }
                        } else {
                            const cardGenre = card.dataset.genre;
                            if (cardGenre === filterType) {
                                show = true;
                            }
                        }
                        card.style.display = show ? 'block' : 'none';
                    });
                }


                // --- Handle EDIT Click ---
                if (editBtn) {
                    const card = editBtn.closest('.movie-card');
                    const cardId = card.dataset.id;
                    const allCards = getCardsDB();
                    const cardData = allCards.find(c => c.id === cardId);
                    
                    if (cardData) {
                        modalTitle.textContent = 'Edit Card';
                        submitBtn.textContent = 'Save Changes';
                        cardIdInput.value = cardData.id;
                        titleInput.value = cardData.title;
                        categoryInput.value = cardData.category;
                        tagsInput.value = cardData.tags;
                        coverUrlInput.value = cardData.coverUrl;
                        
                        updateGenreDatalist(cardData.category, false);
                        genreInput.value = cardData.genre;
                        
                        showUploadModal();
                    } else {
                        showMessage('Could not find card data to edit.', 'error');
                    }
                }
                

                // --- Handle DELETE Click ---
                if (deleteBtn) {
                    cardToDelete = deleteBtn.closest('.movie-card');
                    if (cardToDelete) {
                        confirmModalOverlay.classList.add('show');
                    }
                }
            });
            

            // --- Delete Confirmation Logic ---
            
            function closeConfirmModal() {
                confirmModalOverlay.classList.remove('show');
                cardToDelete = null;
            }

            cancelDeleteBtn.addEventListener('click', closeConfirmModal);
            
            confirmModalOverlay.addEventListener('click', function(event) {
                if (event.target === confirmModalOverlay) {
                    closeConfirmModal();
                }
            });

            confirmDeleteBtn.addEventListener('click', function() {
                if (cardToDelete) {
                    const cardId = cardToDelete.dataset.id;
                    // --- NEW: Get category *before* deleting ---
                    let deletedCategory = null;
                    let allCards = getCardsDB();
                    const cardData = allCards.find(c => c.id === cardId);
                    if (cardData) {
                        deletedCategory = cardData.category;
                    }

                    cardToDelete.classList.add('deleting');
                    
                    setTimeout(() => {
                        try {
                            if (cardToDelete && cardToDelete.parentNode) {
                                cardToDelete.parentNode.removeChild(cardToDelete);
                            }
                            
                            allCards = allCards.filter(card => card.id !== cardId);
                            saveCardsDB(allCards);
                            
                            // --- UPDATED: Update specific category hero ---
                            if (deletedCategory) {
                                updateCategoryHero(deletedCategory);
                            }
                            populateHomePage();
                            showMessage('Card deleted successfully.', 'success');
                            
                        } catch (error) {
                            console.error('Error during deletion:', error);
                            showMessage('Error deleting card.', 'error');
                            if(cardToDelete) cardToDelete.classList.remove('deleting');
                        } finally {
                            closeConfirmModal();
                        }
                    }, 300);
                }
            });

        });
    </script>
</body>
</html>

